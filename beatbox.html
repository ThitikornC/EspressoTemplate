<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ทำสมาธิ (Box Breathing)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap');

        body {
            font-family: 'Sarabun', sans-serif;
            user-select: none;
            -webkit-user-select: none;
        }

        /* Custom Animations */
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fade-in-down {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.2s ease-out; }
        .animate-fade-in-down { animation: fade-in-down 0.3s ease-out; }
        
        .transition-colors-custom {
            transition-property: background-color, border-color, color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 500ms;
        }

        /* Removed .custom-shadow as requested */

        /* Hide scrollbar for clean UI */
        ::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen bg-slate-50 flex flex-col items-center justify-center p-4 overflow-hidden text-slate-800">

    <!-- Header -->
    <header class="absolute top-0 left-0 w-full p-6 flex justify-between items-center z-10">
        <div class="flex items-center gap-2">
            <h1 class="text-xl font-bold text-slate-700">ทำสมาธิ</h1>
        </div>
        
        <div class="flex gap-4">
            <button id="btn-voice" class="p-2 rounded-full hover:bg-slate-200 transition-colors text-slate-400" title="เปิด/ปิดเสียงพูดนำ">
                <i data-lucide="mic-off"></i>
            </button>
            
            <button id="btn-sound" class="p-2 rounded-full hover:bg-slate-200 transition-colors text-slate-600" title="เปิด/ปิดเสียง Effect">
                <i data-lucide="volume-2"></i>
            </button>
            
            <button id="btn-info" class="p-2 rounded-full hover:bg-slate-200 transition-colors text-slate-600" title="วิธีใช้">
                <i data-lucide="info"></i>
            </button>
            
            <button id="btn-settings" class="p-2 rounded-full hover:bg-slate-200 transition-colors text-slate-600" title="ตั้งค่า">
                <i data-lucide="settings"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex flex-col items-center relative w-full max-w-md">
        
        <!-- Settings Panel -->
        <div id="settings-panel" class="hidden absolute top-16 bg-white p-6 rounded-2xl shadow-xl w-full max-w-sm z-20 animate-fade-in-down border border-slate-100">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-lg text-slate-700">ตั้งค่า</h3>
                <button id="close-settings" class="text-slate-400 hover:text-slate-600">
                    <i data-lucide="x" width="20"></i>
                </button>
            </div>
            
            <!-- Duration Slider -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-slate-600 font-medium">ความยาวต่อจังหวะ</span>
                    <span id="duration-display" class="font-bold text-teal-600 text-lg">4 วินาที</span>
                </div>
                <input type="range" id="duration-slider" min="3" max="10" value="4" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-teal-500">
                <div class="flex justify-between text-xs text-slate-400 mt-1">
                    <span>3 (เร็ว)</span>
                    <span>10 (ช้า)</span>
                </div>
            </div>

            <!-- Target Cycles Slider -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <span class="text-slate-600 font-medium">จำนวนรอบเป้าหมาย</span>
                    <span id="target-display" class="font-bold text-indigo-600 text-lg">ไม่จำกัด</span>
                </div>
                <input type="range" id="target-slider" min="0" max="20" step="1" value="0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-500">
                <div class="flex justify-between text-xs text-slate-400 mt-1">
                    <span>∞</span>
                    <span>20 รอบ</span>
                </div>
            </div>

            <div class="mt-4 text-xs text-slate-400 text-center">
                * การเปลี่ยนค่าจะรีเซ็ตการนับรอบปัจจุบัน
            </div>
        </div>

        <!-- Visualizer -->
        <div class="relative w-[320px] h-[320px] flex items-center justify-center mb-8">
            
            <!-- Background Box -->
            <div class="absolute w-64 h-64 border-2 border-slate-100 rounded-3xl transform rotate-45 opacity-50"></div>
            
            <!-- Progress Ring SVG -->
            <svg class="absolute w-full h-full transform -rotate-90 pointer-events-none" viewBox="0 0 300 300">
                <!-- Background Ring -->
                <circle cx="150" cy="150" r="120" stroke="currentColor" stroke-width="8" fill="transparent" class="text-slate-100" />
                
                <!-- Active Progress Ring -->
                <circle id="progress-ring" cx="150" cy="150" r="120" 
                    stroke="currentColor" 
                    stroke-width="8" 
                    fill="transparent" 
                    stroke-dasharray="753.98" 
                    stroke-dashoffset="753.98" 
                    stroke-linecap="round"
                    class="transition-colors-custom text-teal-400" 
                    style="transition: stroke-dashoffset 1s linear;"
                />
            </svg>

            <!-- Center Circle (Lung) -->
            <div id="lung-circle" class="absolute w-32 h-32 rounded-full flex items-center justify-center backdrop-blur-sm transition-all ease-in-out bg-slate-200 scale-100" style="transition-duration: 0.5s;">
                <!-- Idle Icon -->
                <div id="icon-idle" class="text-slate-400 drop-shadow-md">
                    <i data-lucide="play" width="32" height="32" fill="currentColor"></i>
                </div>
                
                <!-- Completed Icon -->
                <div id="icon-completed" class="hidden text-emerald-500 animate-bounce">
                    <i data-lucide="check-circle" width="48" height="48"></i>
                </div>

                <!-- Timer Text -->
                <span id="timer-text" class="hidden text-4xl font-bold text-white drop-shadow-md">4</span>
            </div>
        </div>

        <!-- Instructions -->
        <div class="text-center h-24 mb-6">
            <h2 id="phase-text" class="text-3xl font-bold mb-2 transition-colors duration-500 text-slate-500">พร้อมแล้วกดเริ่ม</h2>
            <p id="instruction-text" class="text-slate-500 text-lg">เตรียมตัวให้ผ่อนคลาย</p>
        </div>

        <!-- Controls -->
        <div class="flex gap-6 items-center">
            <!-- Play Button - Brown Color -->
            <button id="btn-play" class="w-16 h-16 bg-[#8B4513] hover:bg-[#6F370F] text-white rounded-full flex items-center justify-center transition-all transform hover:scale-105 shadow-lg">
                <i data-lucide="play" width="32" fill="currentColor" class="ml-1"></i>
            </button>

            <!-- Pause Button - Lighter Brown -->
            <button id="btn-pause" class="hidden w-16 h-16 bg-[#A0522D] hover:bg-[#8B4513] text-white rounded-full flex items-center justify-center transition-all transform hover:scale-105 shadow-lg">
                <i data-lucide="pause" width="32" fill="currentColor"></i>
            </button>
            
            <!-- Replay Button - Brown Color -->
            <button id="btn-replay" class="hidden w-16 h-16 bg-[#8B4513] hover:bg-[#6F370F] text-white rounded-full flex items-center justify-center transition-all transform hover:scale-105 shadow-lg">
                <i data-lucide="rotate-ccw" width="32"></i>
            </button>

            <!-- Reset Button -->
            <button id="btn-reset" class="w-12 h-12 bg-white text-slate-400 hover:text-slate-600 border-2 border-slate-200 hover:border-slate-300 rounded-full flex items-center justify-center transition-all disabled:opacity-50" disabled>
                <i data-lucide="rotate-ccw" width="20"></i>
            </button>
        </div>

        <!-- Cycle Counter -->
        <div class="mt-8 text-slate-400 font-medium flex flex-col items-center">
            <div class="flex items-center gap-2">
                 <span>จำนวนรอบ:</span>
                 <span id="cycle-count" class="text-slate-600 font-bold text-lg">0</span>
                 <div id="target-count-container" class="hidden flex items-center gap-1">
                     <span class="text-slate-300">/</span>
                     <span id="target-count-display" class="text-indigo-400 font-bold">0</span>
                 </div>
            </div>
            <!-- Progress Bar for Cycles -->
            <div id="cycle-progress-bar-container" class="hidden w-32 h-1 bg-slate-200 rounded-full mt-2 overflow-hidden">
               <div id="cycle-progress-bar" class="h-full bg-indigo-400 transition-all duration-500 w-0"></div>
            </div>
        </div>

    </main>

    <!-- Info Modal -->
    <div id="info-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
        <div class="bg-white rounded-2xl p-8 max-w-sm w-full shadow-2xl relative">
            <button id="close-info" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600">
                <i data-lucide="x" width="24"></i>
            </button>
            <h2 class="text-2xl font-bold text-slate-800 mb-4">การหายใจแบบกล่อง</h2>
            <p class="text-slate-600 mb-4 leading-relaxed">
                Box Breathing เป็นเทคนิคการหายใจที่ช่วยลดความเครียดและเพิ่มสมาธิ
            </p>
            <div class="space-y-3 mb-6">
                <div class="flex items-center gap-3">
                    <div class="w-2 h-2 rounded-full bg-teal-500"></div>
                    <span class="text-slate-700">1. หายใจเข้า 4 วินาที</span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="w-2 h-2 rounded-full bg-indigo-500"></div>
                    <span class="text-slate-700">2. กลั้นหายใจ 4 วินาที</span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="w-2 h-2 rounded-full bg-sky-500"></div>
                    <span class="text-slate-700">3. หายใจออก 4 วินาที</span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="w-2 h-2 rounded-full bg-indigo-500"></div>
                    <span class="text-slate-700">4. กลั้นหายใจ 4 วินาที</span>
                </div>
            </div>
            <button id="btn-understand" class="w-full py-3 bg-teal-500 text-white rounded-xl font-bold hover:bg-teal-600 transition-colors">
                เข้าใจแล้ว
            </button>
        </div>
    </div>

    <script>
        // --- State ---
        const state = {
            isActive: false,
            phase: 'idle', // idle, inhale, hold-in, exhale, hold-out, completed
            timer: 4,
            cycleCount: 0,
            duration: 4,
            targetCycles: 0,
            soundEnabled: true,
            voiceEnabled: false
        };

        let intervalId = null;
        let audioContext = null;

        // --- Config ---
        const phaseConfig = {
            idle: { 
                text: 'พร้อมแล้วกดเริ่ม', 
                instruction: 'เตรียมตัวให้ผ่อนคลาย',
                colorClass: 'text-slate-500',
                bgColorClass: 'bg-slate-200',
                ringClass: 'text-slate-100', // hidden actually
                scale: 'scale-100'
            },
            inhale: { 
                text: 'หายใจเข้า', 
                instruction: 'สูดลมหายใจเข้าลึกๆ ผ่านจมูก',
                colorClass: 'text-teal-600',
                bgColorClass: 'bg-teal-400',
                ringClass: 'text-teal-400',
                scale: 'scale-150'
            },
            'hold-in': { 
                text: 'กลั้นหายใจ', 
                instruction: 'เก็บลมหายใจไว้ในปอด',
                colorClass: 'text-indigo-600',
                bgColorClass: 'bg-indigo-400',
                ringClass: 'text-indigo-400',
                scale: 'scale-150'
            },
            exhale: { 
                text: 'หายใจออก', 
                instruction: 'ปล่อยลมหายใจออกทางปากช้าๆ',
                colorClass: 'text-sky-600',
                bgColorClass: 'bg-sky-400',
                ringClass: 'text-sky-400',
                scale: 'scale-100'
            },
            'hold-out': { 
                text: 'กลั้นหายใจ', 
                instruction: 'ปล่อยปอดให้ว่าง พักไว้',
                colorClass: 'text-indigo-600',
                bgColorClass: 'bg-indigo-300',
                ringClass: 'text-indigo-400',
                scale: 'scale-100'
            },
            completed: {
                text: 'ยอดเยี่ยม!',
                instruction: 'คุณทำครบตามเป้าหมายแล้ว',
                colorClass: 'text-emerald-500',
                bgColorClass: 'bg-emerald-100',
                ringClass: 'text-emerald-400',
                scale: 'scale-110'
            }
        };

        // --- Elements ---
        const els = {
            lungCircle: document.getElementById('lung-circle'),
            progressRing: document.getElementById('progress-ring'),
            timerText: document.getElementById('timer-text'),
            iconIdle: document.getElementById('icon-idle'),
            iconCompleted: document.getElementById('icon-completed'),
            phaseText: document.getElementById('phase-text'),
            instructionText: document.getElementById('instruction-text'),
            btnPlay: document.getElementById('btn-play'),
            btnPause: document.getElementById('btn-pause'),
            btnReplay: document.getElementById('btn-replay'),
            btnReset: document.getElementById('btn-reset'),
            btnVoice: document.getElementById('btn-voice'),
            btnSound: document.getElementById('btn-sound'),
            btnSettings: document.getElementById('btn-settings'),
            btnInfo: document.getElementById('btn-info'),
            settingsPanel: document.getElementById('settings-panel'),
            infoModal: document.getElementById('info-modal'),
            durationSlider: document.getElementById('duration-slider'),
            durationDisplay: document.getElementById('duration-display'),
            targetSlider: document.getElementById('target-slider'),
            targetDisplay: document.getElementById('target-display'),
            cycleCount: document.getElementById('cycle-count'),
            targetCountContainer: document.getElementById('target-count-container'),
            targetCountDisplay: document.getElementById('target-count-display'),
            cycleProgressBarContainer: document.getElementById('cycle-progress-bar-container'),
            cycleProgressBar: document.getElementById('cycle-progress-bar'),
            btnCloseSettings: document.getElementById('close-settings'),
            btnCloseInfo: document.getElementById('close-info'),
            btnUnderstand: document.getElementById('btn-understand')
        };

        // --- Functions ---

        function initIcons() {
            lucide.createIcons();
        }

        function playSound(freq = 440, type = 'sine') {
            if (!state.soundEnabled) return;
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                const ctx = audioContext;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.type = type;
                osc.frequency.setValueAtTime(freq, ctx.currentTime);
                
                gain.gain.setValueAtTime(0.01, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.1, ctx.currentTime + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);

                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + 0.6);
            } catch (e) {
                console.error("Audio error:", e);
            }
        }

        function speak(text) {
            if (!state.voiceEnabled) return;
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'th-TH';
                utterance.rate = 0.9;
                utterance.volume = 1.0;
                window.speechSynthesis.speak(utterance);
            }
        }

        function updateUI() {
            const config = phaseConfig[state.phase];

            // Text
            els.phaseText.textContent = config.text;
            els.instructionText.textContent = config.instruction;
            
            // Text Colors
            // Remove old colors
            Object.values(phaseConfig).forEach(c => {
                els.phaseText.classList.remove(c.colorClass);
            });
            els.phaseText.classList.add(config.colorClass);

            // Lung Circle Appearance
            els.lungCircle.className = `absolute w-32 h-32 rounded-full flex items-center justify-center backdrop-blur-sm transition-all ease-in-out ${config.bgColorClass} ${config.scale}`;
            els.lungCircle.style.transitionDuration = state.isActive ? `${state.duration}s` : '0.5s';

            // Icons & Timer Visibility
            if (state.phase === 'idle') {
                els.iconIdle.classList.remove('hidden');
                els.iconCompleted.classList.add('hidden');
                els.timerText.classList.add('hidden');
                els.btnPlay.classList.remove('hidden');
                els.btnPause.classList.add('hidden');
                els.btnReplay.classList.add('hidden');
                els.btnReset.disabled = true;
            } else if (state.phase === 'completed') {
                els.iconIdle.classList.add('hidden');
                els.iconCompleted.classList.remove('hidden');
                els.timerText.classList.add('hidden');
                els.btnPlay.classList.add('hidden');
                els.btnPause.classList.add('hidden');
                els.btnReplay.classList.remove('hidden');
                els.btnReset.disabled = false;
            } else {
                els.iconIdle.classList.add('hidden');
                els.iconCompleted.classList.add('hidden');
                els.timerText.classList.remove('hidden');
                els.timerText.textContent = state.timer;
                
                // FIXED: แสดงปุ่ม Play/Pause ตามสถานะ isActive จริง
                if (state.isActive) {
                    els.btnPlay.classList.add('hidden');
                    els.btnPause.classList.remove('hidden');
                } else {
                    els.btnPlay.classList.remove('hidden');
                    els.btnPause.classList.add('hidden');
                }
                
                els.btnReplay.classList.add('hidden');
                els.btnReset.disabled = false;
            }

            // Progress Ring
            const radius = 120;
            const circumference = 2 * Math.PI * radius; // ~753.98
            
            // Set Color
            els.progressRing.setAttribute('class', `transition-colors-custom ${config.ringClass}`);
            
            // FIXED: ปรับปรุงการแสดงผลวงกลม (Ring) ไม่ให้รีเซ็ตเมื่อกด Pause
            if (state.phase === 'idle') {
                 els.progressRing.style.strokeDashoffset = circumference; 
                 els.progressRing.style.transition = 'stroke-dashoffset 0.5s ease-out';
            } else if (state.phase === 'completed') {
                 els.progressRing.style.strokeDashoffset = 0; 
                 els.progressRing.style.transition = 'stroke-dashoffset 0.5s ease-out';
            } else {
                // Active or Paused
                const offset = circumference - ((state.timer / state.duration) * circumference);
                els.progressRing.style.strokeDashoffset = offset;
                
                if (state.isActive) {
                    els.progressRing.style.transition = 'stroke-dashoffset 1s linear';
                } else {
                    // เมื่อหยุด ให้หยุด animation
                    els.progressRing.style.transition = 'none';
                }
            }

            // Cycle Counters
            els.cycleCount.textContent = state.cycleCount;
            if (state.targetCycles > 0) {
                els.targetCountContainer.classList.remove('hidden');
                els.targetCountDisplay.textContent = state.targetCycles;
                els.cycleProgressBarContainer.classList.remove('hidden');
                const progress = Math.min((state.cycleCount / state.targetCycles) * 100, 100);
                els.cycleProgressBar.style.width = `${progress}%`;
            } else {
                els.targetCountContainer.classList.add('hidden');
                els.cycleProgressBarContainer.classList.add('hidden');
            }
        }

        function startTimer() {
            if (state.phase === 'completed') {
                resetTimer();
                setTimeout(() => {
                    startExecution();
                }, 100);
            } else {
                startExecution();
            }
        }

        function startExecution() {
            state.isActive = true;
            if (state.phase === 'idle') {
                state.phase = 'inhale';
                state.timer = state.duration;
                playSound(300);
                speak(phaseConfig.inhale.text);
            }
            updateUI();
            
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(tick, 1000);
        }

        function pauseTimer() {
            state.isActive = false;
            if (intervalId) clearInterval(intervalId);
            if ('speechSynthesis' in window) window.speechSynthesis.cancel();
            updateUI();
        }

        function resetTimer() {
            state.isActive = false;
            state.phase = 'idle';
            state.timer = state.duration;
            state.cycleCount = 0;
            if (intervalId) clearInterval(intervalId);
            if ('speechSynthesis' in window) window.speechSynthesis.cancel();
            
            // Reset visuals explicitly
            els.progressRing.style.strokeDashoffset = 2 * Math.PI * 120;
            
            updateUI();
        }

        function tick() {
            if (state.timer <= 1) {
                handlePhaseChange();
            } else {
                state.timer -= 1;
                updateUI();
            }
        }

        function handlePhaseChange() {
            if (navigator.vibrate) navigator.vibrate(50);
            playSound(440);

            let nextPhase = 'idle';
            let shouldIncrementCycle = false;

            switch (state.phase) {
                case 'inhale': nextPhase = 'hold-in'; break;
                case 'hold-in': nextPhase = 'exhale'; break;
                case 'exhale': nextPhase = 'hold-out'; break;
                case 'hold-out': 
                    if (state.targetCycles > 0 && state.cycleCount + 1 >= state.targetCycles) {
                        nextPhase = 'completed';
                        pauseTimer(); // Stop timer loop
                        speak("ยอดเยี่ยม คุณทำครบตามเป้าหมายแล้ว");
                    } else {
                        nextPhase = 'inhale';
                    }
                    shouldIncrementCycle = true;
                    break;
                default: nextPhase = 'idle';
            }

            state.phase = nextPhase;
            state.timer = state.duration; // Reset timer for next phase
            
            if (shouldIncrementCycle) {
                state.cycleCount += 1;
            }

            if (nextPhase !== 'completed' && nextPhase !== 'idle') {
                 speak(phaseConfig[nextPhase].text);
            }

            updateUI();
        }

        // --- Event Listeners ---
        
        els.btnPlay.addEventListener('click', startTimer);
        els.btnPause.addEventListener('click', pauseTimer);
        els.btnReplay.addEventListener('click', startTimer);
        els.btnReset.addEventListener('click', resetTimer);

        els.btnSettings.addEventListener('click', () => {
            els.settingsPanel.classList.toggle('hidden');
            els.btnSettings.classList.toggle('text-teal-600');
            els.btnSettings.classList.toggle('bg-teal-50');
        });

        els.btnCloseSettings.addEventListener('click', () => {
            els.settingsPanel.classList.add('hidden');
            els.btnSettings.classList.remove('text-teal-600', 'bg-teal-50');
        });

        els.btnInfo.addEventListener('click', () => {
            els.infoModal.classList.remove('hidden');
        });

        els.btnCloseInfo.addEventListener('click', () => {
            els.infoModal.classList.add('hidden');
        });
        
        els.btnUnderstand.addEventListener('click', () => {
            els.infoModal.classList.add('hidden');
        });

        els.btnSound.addEventListener('click', () => {
            state.soundEnabled = !state.soundEnabled;
            // Toggle icon
            const icon = els.btnSound.querySelector('i');
            els.btnSound.innerHTML = ''; // clear
            if (state.soundEnabled) {
                icon.setAttribute('data-lucide', 'volume-2');
                els.btnSound.classList.add('text-slate-600');
                els.btnSound.classList.remove('text-slate-400');
            } else {
                icon.setAttribute('data-lucide', 'volume-x');
                els.btnSound.classList.add('text-slate-400');
                els.btnSound.classList.remove('text-slate-600');
            }
            els.btnSound.appendChild(icon);
            initIcons();
        });

        els.btnVoice.addEventListener('click', () => {
            state.voiceEnabled = !state.voiceEnabled;
            const icon = els.btnVoice.querySelector('i');
            els.btnVoice.innerHTML = '';
            if (state.voiceEnabled) {
                icon.setAttribute('data-lucide', 'mic');
                els.btnVoice.classList.add('text-teal-600', 'bg-teal-50');
                els.btnVoice.classList.remove('text-slate-400');
            } else {
                icon.setAttribute('data-lucide', 'mic-off');
                els.btnVoice.classList.remove('text-teal-600', 'bg-teal-50');
                els.btnVoice.classList.add('text-slate-400');
            }
            els.btnVoice.appendChild(icon);
            initIcons();
        });

        els.durationSlider.addEventListener('input', (e) => {
            state.duration = parseInt(e.target.value);
            els.durationDisplay.textContent = `${state.duration} วินาที`;
            resetTimer();
        });

        els.targetSlider.addEventListener('input', (e) => {
            state.targetCycles = parseInt(e.target.value);
            els.targetDisplay.textContent = state.targetCycles === 0 ? "ไม่จำกัด" : `${state.targetCycles} รอบ`;
            if (state.isActive) resetTimer();
            else updateUI(); // Update UI to show/hide counters immediately
        });

        // Initialize
        initIcons();
        updateUI();

    </script>
</body>
</html>